const i=["http://localhost:3000","https://cvstomize-frontend-351889420459.us-central1.run.app","https://cvstomize.com"];async function u(){for(const e of i)try{const n=await chrome.tabs.query({url:`${e}/*`});if(n.length>0){const s=n[0],t=await chrome.scripting.executeScript({target:{tabId:s.id},func:()=>{const r=localStorage.getItem("cvstomize_dev_token");if(r)return r;const a=Object.keys(localStorage);for(const c of a)if(c.startsWith("firebase:authUser"))return JSON.parse(localStorage.getItem(c)).stsTokenManager.accessToken;return null}});if(t&&t[0]&&t[0].result)return t[0].result}}catch(n){console.log(`Failed to get token from ${e}`,n)}return null}chrome.runtime.onMessage.addListener(async(e,n,s)=>{if(e.action==="start_tailoring"){await l("src/offscreen/offscreen.html");const t=await u();t||console.warn("No auth token found. User might not be logged in to CVstomize."),chrome.runtime.sendMessage({action:"run_inference",data:e.jobText,token:t})}});async function l(e){(await chrome.runtime.getContexts({contextTypes:["OFFSCREEN_DOCUMENT"],documentUrls:[e]})).length>0||(o?await o:(o=chrome.offscreen.createDocument({url:e,reasons:["WORKERS"],justification:"Running WebLLM for local AI inference"}),await o,o=null))}let o;
