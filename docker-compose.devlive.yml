# DevLive Environment Override
# Uses REAL GCP services (Vertex AI, Cloud SQL) but keeps dev tools enabled
# Best of both worlds: staging-like backend with dev conveniences
#
# Usage: docker compose -f docker-compose.yml -f docker-compose.devlive.yml up -d
# Or:    ./start-devlive.sh

services:
  # Override backend to use real GCP services
  backend:
    environment:
      - NODE_ENV=development
      # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      # ğŸ”¥ REAL GCP SERVICES (like staging/production)
      # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      # Disable Mock AI -> Use Vertex AI
      - USE_MOCK_AI=false
      # Override Database URL to use Cloud SQL (set in shell or .env.devlive)
      - DATABASE_URL=${DATABASE_URL}
      # Use local Redis for caching (faster for dev)
      - REDIS_URL=${REDIS_URL:-redis://redis:6379}
      # GCP Project for Vertex AI
      - GCP_PROJECT_ID=${GCP_PROJECT_ID:-cvstomize}
      # Point to the mounted service account key
      - GOOGLE_APPLICATION_CREDENTIALS=/app/gcp-key.json
      # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      # ğŸ› ï¸  DEV TOOLS ENABLED (unlike staging/production)
      # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      # Keep dev auth endpoints available
      - ENABLE_DEV_AUTH=true
      # Enable verbose logging
      - LOG_LEVEL=debug
      # Skip rate limiting for testing
      - SKIP_RATE_LIMIT=true
    volumes:
      - ./api:/app
      - /app/node_modules
      # Mount GCP service account key for Vertex AI access
      - ./gcp-key.json:/app/gcp-key.json

  # Override frontend to use dev auth but point to real backend
  frontend:
    environment:
      - NODE_ENV=development
      # Keep dev auth login available (quick test accounts)
      - REACT_APP_ENABLE_DEV_AUTH=true
      # API URL points to local backend (which uses real GCP)
      - REACT_APP_API_URL=http://localhost:3001
      # Show DevLive indicator in UI
      - REACT_APP_ENVIRONMENT=devlive
      - CHOKIDAR_USEPOLLING=true
      - WDS_SOCKET_PORT=0

  # Keep local Redis for caching (no need for remote Redis in devlive)
  redis:
    container_name: cvstomize-redis-devlive

  # Database container won't be used (using Cloud SQL instead)
  # but we keep it defined to satisfy depends_on - it just won't receive traffic
  database:
    container_name: cvstomize-db-devlive-unused
